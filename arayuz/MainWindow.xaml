<Window x:Class="arayuz_deneme_1.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:arayuz_deneme_1"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:gmap="clr-namespace:GMap.NET.WindowsPresentation;assembly=GMap.NET.WindowsPresentation"
        mc:Ignorable="d"
        Title="MainWindow"
        Icon="C:\Users\ferte\source\repos\arayuz_deneme_1\arayuz_deneme_1\images\icon\lagari.ico"
        Height="1080" Width="1920"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Background="{DynamicResource App.Bg}"
        WindowStyle="None" ResizeMode="CanResize">

    <!-- ===================== TEMA & STİLLER ===================== -->
    <Window.Resources>
        <!-- Login giriş animasyonu -->
        <Storyboard x:Key="LoginFadeIn">
            <DoubleAnimation Storyboard.TargetName="OverlayLayer"
                             Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:2.5"/>
        </Storyboard>

        <!-- Login sonrası Overlay→Main geçişi -->
        <Storyboard x:Key="LoginTransition">
            <DoubleAnimation Storyboard.TargetName="OverlayLayer"
                             Storyboard.TargetProperty="Opacity"
                             To="0" Duration="0:0:1.5" />
            <DoubleAnimation Storyboard.TargetName="MainHost"
                             Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:1.8" BeginTime="0:0:0.2"/>
            <DoubleAnimation Storyboard.TargetName="MainScale"
                             Storyboard.TargetProperty="ScaleX"
                             From="0.95" To="1" Duration="0:0:1.8" BeginTime="0:0:0.2"/>
            <DoubleAnimation Storyboard.TargetName="MainScale"
                             Storyboard.TargetProperty="ScaleY"
                             From="0.95" To="1" Duration="0:0:1.8" BeginTime="0:0:0.2"/>
        </Storyboard>

        <DropShadowEffect x:Key="CardShadow" BlurRadius="18" ShadowDepth="0" Opacity="0.3" Color="#000000"/>

        <!-- Üst bar -->
        <Style x:Key="TopBarStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource App.BgElev}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource App.Stroke}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>

        <!-- ===== Karanlık ComboBoxItem (popup satırları) ===== -->
        <Style TargetType="ComboBoxItem">
            <Setter Property="Background" Value="#0E1220"/>
            <Setter Property="Foreground" Value="{DynamicResource App.Text}"/>
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1B253A"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#1F2A43"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ===== KOMPAKT VE KARANLIK ComboBox (popup dahil) ===== -->
        <Style x:Key="CompactCombo" TargetType="ComboBox">
            <Setter Property="Height" Value="22"/>
            <Setter Property="Padding" Value="4,0"/>
            <Setter Property="FontSize" Value="10.5"/>
            <Setter Property="MinWidth" Value="110"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="{DynamicResource App.Card}"/>
            <Setter Property="Foreground" Value="{DynamicResource App.Text}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource App.Stroke}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton"
                                          Background="{TemplateBinding Background}"
                                          Foreground="{TemplateBinding Foreground}"
                                          BorderBrush="{TemplateBinding BorderBrush}"
                                          BorderThickness="{TemplateBinding BorderThickness}"
                                          Focusable="False"
                                          ClickMode="Press"
                                          IsChecked="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                <Grid>
                                    <ContentPresenter Margin="6,0,22,0"
                                                      VerticalAlignment="Center"
                                                      HorizontalAlignment="Left"
                                                      Content="{TemplateBinding SelectionBoxItem}"
                                                      RecognizesAccessKey="True"/>
                                    <Path Data="M 0 0 L 4 4 L 8 0"
                                          Stroke="#9CA3AF"
                                          StrokeThickness="2"
                                          HorizontalAlignment="Right"
                                          VerticalAlignment="Center"
                                          Margin="0,0,6,0"
                                          StrokeStartLineCap="Round"
                                          StrokeEndLineCap="Round"/>
                                </Grid>
                            </ToggleButton>

                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   PopupAnimation="Slide">
                                <Border Background="#0E1220"
                                        BorderBrush="#3A4157"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="2">
                                    <ScrollViewer SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True"
                                                    KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="{DynamicResource App.Accent}"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocusWithin" Value="True">
                                <Setter Property="BorderBrush" Value="{DynamicResource App.Accent}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.55"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CompactTextBox" TargetType="TextBox">
            <Setter Property="Height" Value="22"/>
            <Setter Property="Padding" Value="6,0"/>
            <Setter Property="FontSize" Value="10.5"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="{DynamicResource App.Card}"/>
            <Setter Property="Foreground" Value="{DynamicResource App.Text}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource App.Stroke}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style x:Key="CompactButton" TargetType="Button">
            <Setter Property="Height" Value="24"/>
            <Setter Property="Padding" Value="10,0"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Background" Value="{DynamicResource App.BgElev}"/>
            <Setter Property="Foreground" Value="{DynamicResource App.Text}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource App.Stroke}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>

        <!-- ===================== PANELS MENU (THEME) ===================== -->
        <Style x:Key="PanelsTopItemStyle" TargetType="{x:Type MenuItem}">
            <Setter Property="Foreground" Value="{DynamicResource App.Text}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <Grid>
                            <Border x:Name="HdrBd"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="6"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter VerticalAlignment="Center"
                                                  ContentSource="Header"
                                                  RecognizesAccessKey="True"/>
                            </Border>

                            <Popup x:Name="PART_Popup"
                                   IsOpen="{TemplateBinding IsSubmenuOpen}"
                                   Placement="Bottom"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Fade">
                                <Border Background="{DynamicResource App.Card}"
                                        BorderBrush="{DynamicResource App.Stroke}"
                                        BorderThickness="1"
                                        CornerRadius="10"
                                        Padding="6"
                                        SnapsToDevicePixels="True">
                                    <StackPanel IsItemsHost="True"
                                                KeyboardNavigation.DirectionalNavigation="Cycle"/>
                                </Border>
                            </Popup>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="HdrBd" Property="Background" Value="{DynamicResource App.BgElev}"/>
                            </Trigger>

                            <Trigger Property="IsSubmenuOpen" Value="True">
                                <Setter TargetName="HdrBd" Property="Background" Value="{DynamicResource App.BgElev}"/>
                                <Setter TargetName="HdrBd" Property="BorderBrush" Value="{DynamicResource App.Stroke}"/>
                            </Trigger>

                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{DynamicResource App.Muted}"/>
                                <Setter Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PanelsSubItemStyle" TargetType="{x:Type MenuItem}">
            <Setter Property="Foreground" Value="{DynamicResource App.Text}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <Border x:Name="RowBd"
                                Background="Transparent"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="26"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock x:Name="CheckGlyph"
                                           Grid.Column="0"
                                           FontFamily="Segoe MDL2 Assets"
                                           Text="&#xE73E;"
                                           FontSize="14"
                                           Foreground="{DynamicResource App.Text}"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Center"
                                           Visibility="Collapsed"/>

                                <ContentPresenter Grid.Column="1"
                                                  VerticalAlignment="Center"
                                                  ContentSource="Header"
                                                  RecognizesAccessKey="True"/>
                            </Grid>
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="RowBd" Property="Background" Value="{DynamicResource App.BgElev}"/>
                            </Trigger>

                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckGlyph" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="RowBd" Property="Background" Value="{DynamicResource App.Card}"/>
                                <Setter TargetName="RowBd" Property="BorderBrush" Value="{DynamicResource App.Stroke}"/>
                                <Setter TargetName="RowBd" Property="BorderThickness" Value="1"/>
                            </Trigger>

                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{DynamicResource App.Muted}"/>
                                <Setter Property="Opacity" Value="0.55"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="{x:Type Separator}">
            <Setter Property="Margin" Value="6,4"/>
            <Setter Property="Background" Value="{DynamicResource App.Stroke}"/>
            <Setter Property="Height" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Separator}">
                        <Border Height="{TemplateBinding Height}"
                                Background="{TemplateBinding Background}"
                                CornerRadius="1"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!-- ===================== ROOT LAYER ===================== -->
    <Grid Background="{DynamicResource App.Bg}">
        <!-- === ANA İÇERİK (GİRİŞE KADAR GİZLİ) === -->
        <Grid x:Name="MainHost"
              Visibility="Collapsed"
              Opacity="1"
              RenderTransformOrigin="0.5,0.5"
              LayoutTransform="{DynamicResource App.UiScale}">
            <Grid.RenderTransform>
                <TransformGroup>
                    <ScaleTransform x:Name="MainScale" ScaleX="1" ScaleY="1"/>
                    <TranslateTransform x:Name="MainTrans" X="0" Y="0"/>
                </TransformGroup>
            </Grid.RenderTransform>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="38"/>
                    <RowDefinition Height="155"/>
                    <RowDefinition/>
                </Grid.RowDefinitions>

                <!-- ===== IDE STYLE MENÜ ŞERİDİ ===== -->
                <Border Grid.Row="0"
                        Background="{DynamicResource App.BgElev}"
                        BorderBrush="{DynamicResource App.Stroke}"
                        BorderThickness="0,0,0,1"
                        MouseLeftButtonDown="TopBar_MouseLeftButtonDown">

                    <DockPanel LastChildFill="True" Margin="8,0,8,0">
                        <Menu Background="Transparent"
                              Foreground="{DynamicResource App.Text}"
                              FontSize="12"
                              VerticalAlignment="Center"
                              DockPanel.Dock="Left">

                            <MenuItem Header="Panels" Style="{StaticResource PanelsTopItemStyle}">
                                <MenuItem Header="HUD" Style="{StaticResource PanelsSubItemStyle}"
                                          IsCheckable="True" IsChecked="True"
                                          Click="PanelsMenu_Click" Tag="HUD"/>

                                <MenuItem Header="Telemetry" Style="{StaticResource PanelsSubItemStyle}"
                                          IsCheckable="True" IsChecked="True"
                                          Click="PanelsMenu_Click" Tag="Telemetry"/>

                                <MenuItem Header="Camera" Style="{StaticResource PanelsSubItemStyle}"
                                          IsCheckable="True" IsChecked="True"
                                          Click="PanelsMenu_Click" Tag="Camera"/>

                                <MenuItem Header="Kontrol Paneli" Style="{StaticResource PanelsSubItemStyle}"
                                          IsCheckable="True" IsChecked="True"
                                          Click="PanelsMenu_Click" Tag="ControlPanel"/>

                                <Separator/>

                                <MenuItem Header="Harita" Style="{StaticResource PanelsSubItemStyle}"
                                          IsCheckable="True" IsChecked="True"
                                          Click="PanelsMenu_Click" Tag="Map"/>
                            </MenuItem>

                            <MenuItem Style="{StaticResource PanelsTopItemStyle}"
                                      Header="{Binding ConnectHeader, RelativeSource={RelativeSource AncestorType=Window}}"
                                      Foreground="{Binding ConnectBrush, RelativeSource={RelativeSource AncestorType=Window}}"
                                      Click="OpenConnect_Click">

                                <!-- ✅ FIX: ToolTip DataContext’i PlacementTarget.DataContext -->
                                <MenuItem.ToolTip>
                                    <ToolTip Placement="Bottom"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             HasDropShadow="False"
                                             Padding="0"
                                             DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">

                                        <Border Background="#F20E1220"
                                                BorderBrush="#CC3A4157"
                                                BorderThickness="1"
                                                CornerRadius="12"
                                                Padding="12">
                                            <StackPanel Width="420">

                                                <!-- Başlık -->
                                                <TextBlock Text="{Binding ConnectTipTitle}"
                                                           Foreground="White"
                                                           FontWeight="SemiBold"
                                                           FontSize="13"/>

                                                <TextBlock Margin="0,2,0,10"
                                                           Text="{Binding ConnectTipSubtitle}"
                                                           Foreground="#E6FFFFFF"
                                                           FontSize="11"
                                                           TextWrapping="Wrap"/>

                                                <!-- Satır Satır Bilgi -->
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="120"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- Server -->
                                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Server" Foreground="#D0FFFFFF" FontSize="11"/>
                                                    <TextBlock Grid.Row="0" Grid.Column="1"
                                                               Text="{Binding ConnectTipServer}"
                                                               Foreground="White" FontSize="11" TextWrapping="Wrap"/>

                                                    <!-- Takım No -->
                                                    <TextBlock Grid.Row="1" Grid.Column="0" Margin="0,6,0,0" Text="Takım No" Foreground="#D0FFFFFF" FontSize="11"/>
                                                    <TextBlock Grid.Row="1" Grid.Column="1" Margin="0,6,0,0"
                                                               Text="{Binding ConnectTipTeam}"
                                                               Foreground="White" FontSize="11"/>

                                                    <!-- Kullanıcı -->
                                                    <TextBlock Grid.Row="2" Grid.Column="0" Margin="0,6,0,0" Text="Kullanıcı" Foreground="#D0FFFFFF" FontSize="11"/>
                                                    <TextBlock Grid.Row="2" Grid.Column="1" Margin="0,6,0,0"
                                                               Text="{Binding ConnectTipUser}"
                                                               Foreground="White" FontSize="11" TextWrapping="Wrap"/>

                                                    <!-- Token -->
                                                    <TextBlock Grid.Row="3" Grid.Column="0" Margin="0,6,0,0" Text="Token" Foreground="#D0FFFFFF" FontSize="11"/>
                                                    <TextBlock Grid.Row="3" Grid.Column="1" Margin="0,6,0,0"
                                                               Text="{Binding ConnectTipToken}"
                                                               Foreground="White" FontSize="11" TextWrapping="Wrap"/>

                                                    <!-- Gönderim -->
                                                    <TextBlock Grid.Row="4" Grid.Column="0" Margin="0,6,0,0" Text="Gönderim" Foreground="#D0FFFFFF" FontSize="11"/>
                                                    <TextBlock Grid.Row="4" Grid.Column="1" Margin="0,6,0,0"
                                                               Text="{Binding ConnectTipRate}"
                                                               Foreground="White" FontSize="11"/>

                                                    <!-- RTT / Güç -->
                                                    <TextBlock Grid.Row="5" Grid.Column="0" Margin="0,6,0,0" Text="RTT / Güç" Foreground="#D0FFFFFF" FontSize="11"/>
                                                    <TextBlock Grid.Row="5" Grid.Column="1" Margin="0,6,0,0"
                                                               Text="{Binding ConnectTipRtt}"
                                                               Foreground="White" FontSize="11"/>

                                                    <!-- Peers -->
                                                    <TextBlock Grid.Row="6" Grid.Column="0" Margin="0,6,0,0" Text="Peers" Foreground="#D0FFFFFF" FontSize="11"/>
                                                    <TextBlock Grid.Row="6" Grid.Column="1" Margin="0,6,0,0"
                                                               Text="{Binding ConnectTipPeers}"
                                                               Foreground="White" FontSize="11"/>

                                                    <!-- Health -->
                                                    <TextBlock Grid.Row="7" Grid.Column="0" Margin="0,6,0,0" Text="Health" Foreground="#D0FFFFFF" FontSize="11"/>
                                                    <TextBlock Grid.Row="7" Grid.Column="1" Margin="0,6,0,0"
                                                               Text="{Binding ConnectTipHealth}"
                                                               Foreground="White" FontSize="11" TextWrapping="Wrap"/>

                                                    <!-- HSS -->
                                                    <TextBlock Grid.Row="8" Grid.Column="0" Margin="0,10,0,0" Text="HSS Koord." Foreground="#D0FFFFFF" FontSize="11"/>
                                                    <TextBlock Grid.Row="8" Grid.Column="1" Margin="0,10,0,0"
                                                               Text="{Binding ConnectTipHss}"
                                                               Foreground="White" FontSize="11" TextWrapping="Wrap"/>

                                                    <!-- QR -->
                                                    <TextBlock Grid.Row="9" Grid.Column="0" Margin="0,6,0,0" Text="QR Koord." Foreground="#D0FFFFFF" FontSize="11"/>
                                                    <TextBlock Grid.Row="9" Grid.Column="1" Margin="0,6,0,0"
                                                               Text="{Binding ConnectTipQr}"
                                                               Foreground="White" FontSize="11" TextWrapping="Wrap"/>
                                                </Grid>

                                                <Border Margin="0,10,0,10" Height="1" Background="#55FFFFFF"/>

                                                <!-- Son Durum -->
                                                <TextBlock Text="Son Durum" Foreground="#D0FFFFFF" FontSize="11"/>
                                                <TextBlock Margin="0,3,0,0"
                                                           Text="{Binding ConnectTipLast}"
                                                           Foreground="#FFFFFFFF"
                                                           FontSize="11"
                                                           TextWrapping="Wrap"/>

                                                <TextBlock Margin="0,8,0,0"
                                                           Text="{Binding ConnectTipError}"
                                                           Foreground="#FFFFB3B3"
                                                           FontSize="11"
                                                           TextWrapping="Wrap"/>
                                            </StackPanel>
                                        </Border>
                                    </ToolTip>
                                </MenuItem.ToolTip>
                            </MenuItem>
                        </Menu>
                    </DockPanel>
                </Border>

                <!-- ÜST BAR -->
                <Border Grid.Row="1" Style="{StaticResource TopBarStyle}"
                        MouseLeftButtonDown="TopBar_MouseLeftButtonDown">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="250"/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Style="{StaticResource LogoCard}">
                            <Grid>
                                <Image Style="{StaticResource LogoImageStyle}"/>
                            </Grid>
                        </Border>

                        <Border Grid.Column="1" Style="{StaticResource MenuCard}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="900"/>
                                    <ColumnDefinition/>
                                </Grid.ColumnDefinitions>

                                <Grid Grid.Column="0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>

                                    <Grid Grid.Row="0" Height="6" Margin="6,0,6,8">
                                        <Border Background="{DynamicResource App.BgElev}" CornerRadius="3"/>
                                        <Border x:Name="ActiveBar"
                                                Background="{DynamicResource App.Accent}"
                                                CornerRadius="3"
                                                Width="210" HorizontalAlignment="Left" Margin="6,0,0,0"/>
                                    </Grid>

                                    <Grid Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <Button Style="{StaticResource MenuButtonFlat}" x:Name="DATA_BUTTON" Click="DATA_BUTTON_click">
                                                <Image Style="{StaticResource IconImageStyle}"
                                                       Source="pack://application:,,,/images/button_image/DATA.png" Height="40"/>
                                            </Button>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <Button Style="{StaticResource MenuButtonFlat}" x:Name="PLAN_BUTTON" Click="PLAN_BUTTON_click">
                                                <Image Style="{StaticResource IconImageStyle}"
                                                       Source="pack://application:,,,/images/button_image/PLAN.png" Height="40"/>
                                            </Button>
                                        </StackPanel>

                                        <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <Button Style="{StaticResource MenuButtonFlat}" x:Name="CONFIG_BUTTON" Click="CONFIG_BUTTON_Click">
                                                <Image Style="{StaticResource IconImageStyle}"
                                                       Source="pack://application:,,,/images/button_image/CONFIG.png" Height="40"/>
                                            </Button>
                                        </StackPanel>

                                        <StackPanel Grid.Column="3" VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <Button Style="{StaticResource MenuButtonFlat}" x:Name="SETUP_BUTTON" Click="SETUP_BUTTON_Click">
                                                <Image Style="{StaticResource IconImageStyle}"
                                                       Source="pack://application:,,,/images/button_image/SETUP.png" Height="40"/>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Grid>

                                <!-- Sağ: Bağlantı kartı -->
                                <Border Grid.Column="1"
                                        Background="{DynamicResource App.BgElev}"
                                        CornerRadius="10"
                                        BorderBrush="{DynamicResource App.Stroke}" BorderThickness="1"
                                        Margin="8,0,24,0" Padding="6"
                                        HorizontalAlignment="Center" VerticalAlignment="Center"
                                        MaxHeight="140">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="4"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="4"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Grid.Row="0"
                                              Background="{DynamicResource App.Card}"
                                              Margin="0,0,0,2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="6"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Text="Kaynak"
                                                       VerticalAlignment="Center"
                                                       Foreground="{DynamicResource App.Muted}"
                                                       FontSize="10"/>

                                            <ComboBox x:Name="SourceCombo"
                                                      Grid.Column="2"
                                                      Style="{StaticResource CompactCombo}"
                                                      SelectedIndex="0">
                                                <ComboBoxItem Content="COM"/>
                                                <ComboBoxItem Content="Server"/>
                                                <ComboBoxItem Content="Simülasyon"/>
                                            </ComboBox>
                                        </Grid>

                                        <Grid x:Name="COMPanel"
                                              Grid.Row="2"
                                              Background="{DynamicResource App.Card}"
                                              Margin="0,0,0,2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="6"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="6"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <ComboBox x:Name="ComPortCombo"
                                                      Grid.Column="0"
                                                      Style="{StaticResource CompactCombo}"
                                                      ToolTip="COM Port"/>

                                            <ComboBox x:Name="BaudRateCombo"
                                                      Grid.Column="2"
                                                      Style="{StaticResource CompactCombo}"
                                                      ToolTip="Baud Rate"/>

                                            <Button x:Name="RefreshComBtn"
                                                    Grid.Column="4"
                                                    Style="{StaticResource CompactButton}"
                                                    Width="28"
                                                    ToolTip="COM portlarını yenile"
                                                    Click="RefreshCom_Click">
                                                <TextBlock x:Name="RefreshComIcon"
                                                           FontFamily="Segoe MDL2 Assets"
                                                           Text="&#xE72C;"
                                                           FontSize="12"
                                                           RenderTransformOrigin="0.5,0.5">
                                                    <TextBlock.RenderTransform>
                                                        <RotateTransform x:Name="RefreshRotate" Angle="0"/>
                                                    </TextBlock.RenderTransform>
                                                </TextBlock>
                                            </Button>
                                        </Grid>

                                        <Grid x:Name="ServerPanel"
                                              Grid.Row="2"
                                              Visibility="Collapsed"
                                              Background="{DynamicResource App.Card}"
                                              Margin="0,0,0,2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="6"/>
                                                <ColumnDefinition Width="80"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBox x:Name="ServerHostBox"
                                                     Grid.Column="0"
                                                     Style="{StaticResource CompactTextBox}"
                                                     Text="127.0.0.1"
                                                     ToolTip="Host (IP/Ad)"/>

                                            <TextBox x:Name="ServerPortBox"
                                                     Grid.Column="2"
                                                     Style="{StaticResource CompactTextBox}"
                                                     Text="5006"
                                                     ToolTip="Port"/>
                                        </Grid>

                                        <Grid x:Name="SimPanel"
                                              Grid.Row="2"
                                              Visibility="Collapsed"
                                              Background="{DynamicResource App.Card}"
                                              Margin="0,0,0,2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="6"/>
                                                <ColumnDefinition Width="80"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBox x:Name="SimHostBox"
                                                     Grid.Column="0"
                                                     Style="{StaticResource CompactTextBox}"
                                                     Text="127.0.0.1"
                                                     ToolTip="Simülasyon MAVLink Host (WSL/Bridge IP)"/>

                                            <TextBox x:Name="SimPortBox"
                                                     Grid.Column="2"
                                                     Style="{StaticResource CompactTextBox}"
                                                     Text="14550"
                                                     ToolTip="Simülasyon MAVLink Port"/>
                                        </Grid>

                                        <Grid Grid.Row="4"
                                              Margin="0,2,0,0"
                                              Background="{DynamicResource App.Card}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="8"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <Button x:Name="ConnectBtn"
                                                    Grid.Column="0"
                                                    Style="{StaticResource CompactButton}"
                                                    MinWidth="150"
                                                    Padding="12,0"
                                                    HorizontalAlignment="Left"
                                                    Background="{DynamicResource App.Accent}"
                                                    Foreground="White"
                                                    BorderThickness="0"
                                                    Click="ConnectBtn_Click"
                                                    Content="Connect"/>

                                            <TextBlock x:Name="StatusText"
                                                       Grid.Column="2"
                                                       Margin="2,0,2,0"
                                                       FontSize="10"
                                                       HorizontalAlignment="Right"
                                                       VerticalAlignment="Center"
                                                       Foreground="{DynamicResource App.Muted}"
                                                       TextTrimming="CharacterEllipsis"
                                                       Text="Durum: Beklemede" />
                                        </Grid>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>

                <Border Grid.Row="2"
                        Margin="16"
                        Background="{DynamicResource App.Card}"
                        CornerRadius="18"
                        BorderBrush="{DynamicResource App.Stroke}"
                        BorderThickness="1"
                        Effect="{StaticResource CardShadow}">
                    <ContentControl x:Name="CONTENT_HOST"/>
                </Border>

                <ResizeGrip Grid.Row="2"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Margin="8" />
            </Grid>
        </Grid>

        <!-- === PENCERE BUTONLARI === -->
        <Grid x:Name="OverlayButtons"
              IsHitTestVisible="True"
              HorizontalAlignment="Right" VerticalAlignment="Top"
              Margin="0,-4,6,0"
              Panel.ZIndex="20">
            <StackPanel Orientation="Horizontal">
                <Button Style="{StaticResource TitleBtn}" Click="MinBtn_Click" ToolTip="Küçült">
                    <Path Data="M 4 18 H 20"
                          Stroke="{DynamicResource App.Muted}"
                          StrokeThickness="2"
                          StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                </Button>
                <Button Style="{StaticResource TitleBtn}" Click="MaxBtn_Click" ToolTip="Büyüt / Geri al">
                    <Grid Width="18" Height="14">
                        <Rectangle Width="12" Height="10"
                                   Stroke="{DynamicResource App.Muted}"
                                   StrokeThickness="2"
                                   Margin="0,0,6,4"
                                   HorizontalAlignment="Right" VerticalAlignment="Bottom"/>
                        <Rectangle Width="12" Height="10"
                                   Stroke="{DynamicResource App.Muted}"
                                   StrokeThickness="2"
                                   HorizontalAlignment="Left" VerticalAlignment="Top"/>
                    </Grid>
                </Button>
                <Button Style="{StaticResource TitleBtnClose}" Click="CloseBtn_Click" ToolTip="Kapat">
                    <Path Data="M4,4 L20,20 M20,4 L4,20"
                          Stroke="#EF4444"
                          StrokeThickness="2.2"
                          StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                </Button>
            </StackPanel>
        </Grid>

        <!-- === GİRİŞ OVERLAY === -->
        <Grid x:Name="OverlayLayer"
              Background="#B3000000"
              Panel.ZIndex="10">
            <Viewbox Stretch="Uniform"
                     StretchDirection="DownOnly"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center">
                <ContentControl x:Name="OverlayHost"/>
            </Viewbox>
        </Grid>
    </Grid>
</Window>
